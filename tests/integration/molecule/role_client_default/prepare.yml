---
- name: Prepare
  hosts: all
  vars:
    ansible_user: root
  tasks:
    - name: Install sudo
      package:
        name: sudo
        state: present
    - name: Create molecule group
      ansible.builtin.group:
        name: molecule
    - name: Create molecule user
      ansible.builtin.user:
        name: molecule
        group: molecule
    - name: Allow sudo for molecule user
      copy:
        dest: "/etc/sudoers.d/molecule"
        mode: 0440
        owner: root
        group: root
        content: |
          molecule ALL=(ALL) NOPASSWD:ALL
